<?xml version="1.0" encoding="UTF-8"?>

<bundle name="tcoffee" version="9.03"> 
  <title>T-Coffee Server</title> 
  <description>A collection of tools for Computing, Evaluating and
    Manipulating Multiple Alignments of DNA, RNA, Protein Sequences and
    Structures</description>
  <author>Cedric Notredame</author>
  <email>tcoffee.msa@gmail.com</email>

 <!-- ========================================================================
      Command DEFINITIONS   
      ======================================================================== -->
  <def>
    <dictionary>
      <label key="input_file" value="Input(s)" />
      <label key="system_file" value="System" />
      <label key="error_file" value="System" />
      <label key="MSA" value="Multiple Alignment" />
      <label key="GUIDE_TREE" value="Tree" />
      <label key="PHYLOGENIC_TREE" value="Tree" />
      <label key="Template_List" value="Template List" />
    </dictionary>
  
    <valid-result>
      <events>
        <mail> 
        <to>${email}</to>
        <subject>T-Coffee alignment result</subject>
        <body>
		Hello, 
		
		Your alignment has been completed. 
		
		Click here to view the result --> ${_result_url} 
		
		If you have questions, suggestions or to report problems 
		do not reply to this message, write instead to tcoffee@googlegroups.com. 
		  
		
		Cheers, 
		T-Coffee team
        </body>
        </mail>
      </events>
    </valid-result>
    
    <fail-result>
      <events>
        <mail> 
        <to>${email}</to>
        <subject>T-Coffee alignment result</subject>
        <body>
		Hi, 
		
		Unfortunately your T-Coffee alignment could not complete. 
		
		Click here to get more information --> ${_result_url} 
		
		If you have questions, suggestions or to report problems 
		do not reply to this message, write instead to tcoffee@googlegroups.com. 
		
		
		Cheers, 
		T-Coffee team
        </body>
        </mail>
      </events>
    </fail-result>
  </def>


  <!-- ========================================================================
      TCoffee REGULAR   
      ======================================================================== -->
  <service name="regular" >
    <title>T-Coffee</title>
   <group>Alignment</group>      
    <description>Aligns DNA, RNA or Proteins using the default T-Coffee</description>
    <cite><![CDATA[http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&db=PubMed&list_uids=21558174,10964570]]></cite>
    
    <input>
      <fieldset >
        <title>Sequences input</title>
    <description>Paste or upload your set of sequences in FASTA format</description>
      
        <field type='memo' name='seqs' label='Sequences to align' >
          <hint>Enter the sequences to align</hint>
          <validation format="FASTA" type="amino-acid" required="true" minnum="2" maxnum="150" maxlen='10000' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 10000 char length</maxlen-error>
          </validation>
          
          <sample>public/sample.fasta.txt</sample>
        </field>

      </fieldset>
      
      <fieldset hideable="true" >
        <title>Methods</title>
        <description>T-Coffee produces an alignment by combining the output of several alignment methods. Use this section to select the individual methods.</description>
        
        <field type="checkbox" name="method1" label="Pairwise Structual Methods">
          <choices>sap_pair, TMalign_pair, mustang_pair </choices>
        </field>
        
        <field type="checkbox" name="method2" label="Multiple Methods">
          <choices>pcma_msa, mafft_msa, clustalw_msa, dialigntx_msa, poa_msa, muscle_msa, probcons_msa, t_coffee_msa, amap_msa, kalign_msa, fsa_msa, probconsRNA_msa, mus4_msa</choices>
        </field>

        <field type="checkbox" name="method3" label="Pairwise Methods">
          <choices>best_pair4prot, fast_pair, clustalw_pair, lalign_id_pair, slow_pair, proba_pair </choices>
        </field>
        
      </fieldset>
      
      
    <fieldset hideable="true">
     <title>Output options</title>
     <description>Use this section to control the output format.</description>
      
     <field type="checkbox" name='output' label='Alignment format' >
       <value>score_html score_ascii fasta_aln clustalw_aln phylip</value>
       <choices>score_html, clustalw_aln, pir_aln, pir_seq, gcg, fasta_aln, score_ascii, msf_aln, phylip, score_pdf</choices>
       <readonly>score_html score_ascii</readonly>
     </field>

     <field type='dropdown' name='letter' label='Case' >
       <hint>Output case selection</hint>
       <choices>upper, lower, keep</choices>
     </field>      

     <field type='dropdown' name='seqnos' label='Residue number' >
      <hint>Print the residue number</hint>
      <choices>on, off</choices>
      <value>off</value>  
     </field>
      
     <field type='dropdown' name='outorder' >
       <choices>input, aligned</choices>
     </field>
     
     <field type="text" name="msa_max_len" label="Alignment length" >
     	<hint>The maximum length of the result alignment, after that the sequence is splitted on another row</hint>
     	<value>80</value>
     	<validation format="integer" min="20">
     		<format-error>The entered value is not an integer number</format-error>
     		<min-error>The length value cannot be less than 20</min-error>
     	</validation>
     </field> 
    </fieldset>
      

    <fieldset>
        <field type='text' name="email" label='Your email address' >
          <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
          <validation format="EMAIL" />
        </field>
    </fieldset>
    </input>
    
    <process>
      <qsub>  
      <tcoffee >
        <args>
          -in=${seqs} 
          -mode=regular 
          -method=${method1} ${method2} ${method3} 
          -output=${output} 
          -maxnseq=150 
          -maxlen=10000 
          -case=${letter} 
          -seqnos=${seqnos} 
          -outorder=${outorder} 
          -run_name=result
          -multi_core=${settings.multicore}
        </args>
      </tcoffee>
      </qsub>   
    </process>
    
  </service>
  
  <!--=========================================================================
      M-COFFEE  
      ========================================================================= -->

  <service name="mcoffee">
    <title>M-Coffee</title>
    <description>Aligns DNA, RNA or Proteins by combining the output of popular aligners</description>
    <group>Alignment</group>
  <cite><![CDATA[http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&db=PubMed&list_uids=21558174,17526519,16556910,10964570]]></cite>
    
    <input>
  <fieldset >
    <title>Sequences input</title>
    <description>Paste or upload your set of sequences in FASTA format</description>
    
    <field type='memo' name="seqs" label='Sequences to align' >
          <hint>Enter the sequences to align</hint>
            <validation format='FASTA' required='true' minnum='2' maxnum='150' maxlen='2500' >
              <required-error>You have to enter the sequences to align</required-error>
              <format-error>Sequences have to be in FASTA format</format-error>
              <minnum-error>You must enter at least 2 sequences</minnum-error>
              <maxnum-error>You can enter at most 150 sequences</maxnum-error>
              <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
            </validation>
          
          <sample>public/sample.fasta.txt</sample>
    </field>

    </fieldset>

  <fieldset hideable="true" >
        <title>Alignment Computation</title>
        <description>M-Coffee computes its alignments by combining a collection of Multiple Alignments named a Library. In this section you can select the methods you want to combine into the library. You can choose pairwise and multiple sequence alignment methods. The standard M-Coffee protocol only uses Multiple sequence alignment methods.</description>
        
        <field type="checkbox" name="lib1" label="Pairwise Methods">
          <choices>Mlalign_id_pair, Mclustalw_pair, Mpoa_pair, Mprobcons_pair, Mfast_pair, Mproba_pair, Mmafft_pair, Mdialigntx_pair, Mslow_pair, Mpcma_pair, Mmuscle_pair</choices>
        </field>
        
        <field type="checkbox" name="lib2" label="Multiple Methods" >
          <value>Mpcma_msa, Mmafft_msa, Mclustalw_msa, Mdialigntx_msa, Mpoa_msa, Mmuscle_msa, Mprobcons_msa, Mt_coffee_msa</value>
          <choices>Mpcma_msa, Mmafft_msa, Mclustalw_msa, Mdialigntx_msa, Mpoa_msa, Mmuscle_msa, Mprobcons_msa, Mt_coffee_msa</choices>
        </field>
  </fieldset>

  <fieldset hideable="true">
    <title>Output options</title>
    <description>Use this section to control the output format.</description>
    
    <field type="checkbox" name='output' label='Alignment format' >
      <value>score_html fasta_aln clustalw_aln phylip score_ascii</value>
      <choices>score_html, clustalw_aln, pir_aln, pir_seq, gcg, fasta_aln, score_ascii, msf_aln, phylip, score_pdf</choices>
      <readonly>score_html score_ascii</readonly>
    </field>
    
    <field type='dropdown' name='letter' label='Case' >
      <hint>Output case selection</hint>
      <choices>upper, lower, keep</choices>
    </field>      
    
    <field type='dropdown' name='seqnos' label='Residue number' >
    <hint>Print the residue number</hint>
    <choices>on, off</choices>
    <value>off</value>  
    </field>
    
    <field type='dropdown' name='outorder' >
      <choices>input, aligned</choices>
    </field>
    
      <field type="text" name="msa_max_len" label="Alignment length" >
     	<hint>The maximum length of the result alignment, after that the sequence is splitted on another row</hint>
     	<value>80</value>
     	<validation format="integer" min="20">
     		<format-error>The entered value is not an integer number</format-error>
     		<min-error>The length value cannot be less than 20</min-error>
     	</validation>
     </field> 
  </fieldset>  

  <fieldset>
    <field type='text' name="email" label='Your email address' >
      <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
      <validation format="EMAIL" />
    </field>
  </fieldset>
      
    </input>
    
    <process>
      <qsub>
      <tcoffee>
        <args>
          -in=${seqs} ${lib1} ${lib2} 
          -output=${output} 
          -tree 
          -maxnseq=150 
          -maxlen=2500 
          -case=${letter} 
          -seqnos=${seqnos} 
          -outorder=${outorder}
          -run_name=result
          -multi_core=${settings.multicore}
        </args> 
      </tcoffee>
      </qsub>
    </process>
  </service>
    

  <!-- ========================================================================
      R-COFFEE
       ======================================================================== -->

  <service name="rcoffee">
  <title>R-Coffee</title>
  <description>Aligns RNA sequences using predicted secondary structures</description>
  <group>Alignment</group>
  <cite><![CDATA[http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&db=PubMed&list_uids=21558174,18483080,18420654,10964570]]></cite>
  
  <input>
    <fieldset >
      <title>Sequences input</title>
      <description>Paste or upload your set of sequences in FASTA format</description>
      
      <field type='memo' name="seqs" label='Sequences to align' >
          <hint>Enter the sequences to align</hint>
            <validation format='FASTA' type='nucleic-acid' required='true' minnum='2' maxnum='150' maxlen='2500' >
              <required-error>You have to enter the sequences to align</required-error>
              <format-error>Sequences have to be in FASTA format</format-error>
              <minnum-error>You must enter at least 2 sequences</minnum-error>
              <maxnum-error>You can enter at most 150 sequences</maxnum-error>
              <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
            </validation>
          
          <sample>public/sample-dna.fasta.txt</sample>
      </field>
  
      </fieldset>

    <fieldset hideable="true" >
          <title>Alignment Computation</title>
          <description>R-Coffee computes its alignments by combining a collection of Pairwise and Multiple Alignments named a Library. In this section you can select the methods you want to combine into the library. You can choose pairwise and multiple sequence alignment methods. </description>
          
        <field type="checkbox" name="method1" label="Multiple Methods">
          <value>mafft_msa muscle_msa probconsRNA_msa</value>
          <choices>pcma_msa, mafft_msa, clustalw_msa, dialigntx_msa, poa_msa, muscle_msa, t_coffee_msa, amap_msa, kalign_msa, fsa_msa, probconsRNA_msa, mus4_msa</choices>
        </field>

        <field type="checkbox" name="method2" label="Pairwise Methods">
          <choices>fast_pair, clustalw_pair, lalign_id_pair, slow_pair, proba_pair </choices>
        </field>
          
    </fieldset>
  
    <fieldset hideable="true">
      <title>Output options</title>
      <description>Use this section to control the output format.</description>
      
      <field type="checkbox" name='output' label='Alignment format' >
        <value>score_html fasta_aln clustalw_aln phylip score_ascii</value>
        <choices>score_html, clustalw_aln, pir_aln, pir_seq, gcg, fasta_aln, score_ascii, msf_aln, phylip, score_pdf</choices>
        <readonly>score_html score_ascii</readonly>
      </field>
      
      <field type='dropdown' name='letter' label='Case' >
        <hint>Output case selection</hint>
        <choices>upper, lower, keep</choices>
      </field>      
      
      <field type='dropdown' name='seqnos' label='Residue number' >
      <hint>Print the residue number</hint>
      <choices>on, off</choices>
      <value>off</value>  
      </field>
      
      <field type='dropdown' name='outorder' >
        <choices>input, aligned</choices>
      </field>
      
      <field type="text" name="msa_max_len" label="Alignment length" >
     	<hint>The maximum length of the result alignment, after that the sequence is splitted on another row</hint>
     	<value>80</value>
     	<validation format="integer" min="20">
     		<format-error>The entered value is not an integer number</format-error>
     		<min-error>The length value cannot be less than 20</min-error>
     	</validation>
     </field> 
      
    </fieldset>  
  
    <fieldset>
      <field type='text' name="email" label='Your email address' >
        <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
        <validation format="EMAIL" />
      </field>
    </fieldset>
        
  </input>
  
  <process>
      <qsub>
      <tcoffee>
        <args >
          -in=${seqs}
          -method=${method1} ${method2} 
          -output=${output} 
          -maxnseq=150 
          -maxlen=2500 
          -case=${letter} 
          -seqnos=${seqnos} 
          -outorder=${outorder} 
          -run_name=result
          -tree
          -special_mode=rcoffee
          -method_limits=consan_pair 5 150
          -multi_core=${settings.multicore}
        </args>
      </tcoffee>
    </qsub>
  </process>
  </service>
  
<!-- ========================================================================
      SARA-COFFEE
     ======================================================================== -->

  <service name="saracoffee">
  <title>SARA-Coffee</title>
  <description>Aligns RNA sequences using tertiary structure (new)</description>
  <group>Alignment</group>
  <cite><![CDATA[http://www.ncbi.nlm.nih.gov/pubmed/24972831]]></cite>
  
  <input>
    <fieldset >
      <title>Sequences input</title>
      <description>Paste or upload your set of sequences in FASTA format</description>
      
      <field type='memo' name="seqs" label='Sequences to align' >
          <hint>Enter here the RNA sequences to align. Sequences have to be in FASTA format. The sequence headers must indicate the structure PDB id and the considered chain separated by an underscore (i.e. >PDBid_chain)</hint>
            <validation format='FASTA' type='nucleic-acid' required='true' minnum='2' >
              <required-error>You have to enter the sequences to align</required-error>
              <format-error>Sequences have to be in FASTA format</format-error>
              <minnum-error>You must enter at least 2 sequences</minnum-error>
            </validation>
          
          <sample>public/sample-rna-sara2.fasta.txt</sample>
      </field>
  
      </fieldset>

  
    <fieldset hideable="true">
      <title>Output options</title>
      <description>Use this section to control the output format.</description>
      
      <field type="checkbox" name='output' label='Alignment format' >
        <hint>Specifies the format used for outputting the result MSA</hint>
        <value>score_html clustalw_aln</value>
        <choices>score_html, clustalw_aln, fasta_aln, score_ascii, msf_aln, phylip, score_pdf</choices>
        <readonly>score_html, clustalw_aln</readonly>
      </field>
      
      <field type='dropdown' name='letter' label='Case' >
        <hint>Causes the output alignment to contain only upper case, lower case or to keep the original letters formatting</hint>
        <choices>upper, lower, keep</choices>
      </field>      
      
      <field type='dropdown' name='seqnos' label='Residue number' >
      <hint>Causes the output alignment to contain residue numbers at the end of each line</hint>
      <choices>on, off</choices> 
      <value>off</value> 
      </field>
      
      <field type='dropdown' name='outorder' label='Output order' >
        <hint>
        Sets the order of the sequences in the output alignment: 'input' means the sequences are kept in the original order;
 'aligned' means the sequences come in the order indicated by the tree
        </hint>
        <choices>input, aligned</choices>
      </field>
      
      <field type="text" name="msa_max_len" label="Alignment length" >
     	<hint>The max number of columns of the result alignment, after that the alignment returns to a new line</hint>
     	<value>80</value>
     	<validation format="integer" min="20">
     		<format-error>The entered value is not an integer number</format-error>
     		<min-error>The length value cannot be less than 20</min-error>
     	</validation>
     </field> 
      
    </fieldset>  
  
    <fieldset>
      <field type='text' name="email" label='Your email address' >
        <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas</hint>
        <validation format="EMAIL" />
      </field>
    </fieldset>
        
  </input>
  
  <process>
      <qsub>
      <tcoffee>
        <script>  
export X3DNA=${settings.saracoffee.X3DNA}; 
export PDB_DIR=${settings.saracoffee.PDB_DIR}; 
export NO_REMOTE_PDB_DIR=1; 
unset MAFFT_BINARIES;
(cd $CACHE_4_TCOFFEE; ln -s ${settings.saracoffee.HOME}/pdb_entry_type.txt);
t_coffee \
 -in ${seqs} \
 -method sara_pair \
 -template_file ${settings.saracoffee.TEMPLATE_FILE},RNA \
 -extend_mode rna2 \
 -relax_lib 0 \
 -transform dna2rna \
 -run_name=result \
 -output ${output} \
 -case=${letter} \
 -seqnos=${seqnos} \
 -outorder=${outorder} \
 -multi_core=${settings.multicore} \
 -pdb_min_sim 0 \
 -quiet stdout 
        </script>
      </tcoffee>
    </qsub>
  </process>
  </service>


  <!-- ========================================================================
      EXPRESSO   
      ======================================================================== -->
  <service name="expresso">
   <title >Expresso</title>
   <description>Aligns protein sequences using structural information</description>
   <group>Alignment</group>
     <cite><![CDATA[http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&db=PubMed&list_uids=21558174,16845081,15201059,15215345,10964570]]></cite>
  
     <input>
      <fieldset >
        <title>Sequences input</title>
    <description>Paste or upload your set of sequences in FASTA format</description>
      
        <field type='memo' name="seqs" label='Sequences to align' >
          <hint>Enter the sequences to align</hint>
          <validation format="FASTA" type="amino-acid" required="true" minnum="2" maxnum="150" maxlen="2500">
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
          </validation>
          
          <sample>public/sample.fasta.txt</sample>
        </field>

      </fieldset>
      
      <fieldset hideable="true">
        <title>Structure(s) input</title>
        <description>Upload your PDB structure if needed (Do NOT upload Confidential Data!)</description>

        <field type="file" name="pdb1" label="PDB file" >
        </field>
  
        <field type="file" name="pdb2" label="PDB file" >
        </field>
  
        <field type="file" name="pdb3" label="PDB file" >
        </field>

      </fieldset>
      
      <fieldset hideable="true" >
        <title>Library Computation</title>
        <description>Select the methods you want to use to compute the library. T-Coffee uses various sequence and structure alignment methods to compile a collection of alignments known as a Library. Use this section to select the methods.</description>
        
        <field type="checkbox" name="method1" label="Pairwise Structual Methods">
          <choices>sap_pair, TMalign_pair, mustang_pair </choices>
        </field>
        
        <field type="checkbox" name="method2" label="Multiple Methods">
          <choices>pcma_msa, mafft_msa, clustalw_msa, dialigntx_msa, poa_msa, muscle_msa, probcons_msa, t_coffee_msa, amap_msa, kalign_msa, fsa_msa, probconsRNA_msa, mus4_msa</choices>
        </field>

        <field type="checkbox" name="method3" label="Pairwise Methods">
          <choices>best_pair4prot, fast_pair, clustalw_pair, lalign_id_pair, slow_pair, proba_pair </choices>
        </field>

      </fieldset>
      
      <fieldset hideable="true">
        <title>PDB structure selection</title>
        <description>Specify which PDB structure (template) should be associated with which each sequence. The uploaded PDBs are automatically associated with their own sequence. Check the box to automatically fetch the templates, or fill the box and specify the sequence/template association</description>
        <field type='memo' name='templateFile' label='Enter your template' >
        <hint>
        <![CDATA[
    Check the box below to automatically fetch the templates, or fill this box and specify the sequence/template association using the following format (specified template superseed the others):
<pre>
>sequence_name1 _P_ PDBID
>sequence_name2 _P_ PDBID
...       
</pre>  
        ]]>
        </hint>
        
        </field>
        
        <field type='checkbox' name='templateCheck' label='Automatically fetch pdb templates' >
          <hint>Check This Box To automatically Fetch Homologous Structures with BLAST</hint>
          <choices>MODE_PDB</choices>    
        </field>
        
      </fieldset>

    <fieldset hideable="true">
     <title>Output options</title>
     <description>Use this section to control the output format.</description>
      
     <field type="checkbox" name='output' label='Alignment format' >
       <value>score_html fasta_aln clustalw_aln phylip score_ascii</value>
       <choices>score_html, clustalw_aln, pir_aln, pir_seq, gcg, fasta_aln, score_ascii, msf_aln, phylip, score_pdf</choices>
       <readonly>score_html score_ascii</readonly>
     </field>

     <field type='dropdown' name='letter' label='Case' >
       <hint>Output case selection</hint>
       <choices>upper, lower, keep</choices>
     </field>      

     <field type='dropdown' name='seqnos' label='Residue number' >
      <hint>Print the residue number</hint>
      <choices>on, off</choices>
      <value>off</value>  
     </field>
      
     <field type='dropdown' name='outorder' >
       <choices>input, aligned</choices>
     </field>
 
      <field type="text" name="msa_max_len" label="Alignment length" >
     	<hint>The maximum length of the result alignment, after that the sequence is splitted on another row</hint>
     	<value>80</value>
     	<validation format="integer" min="20">
     		<format-error>The entered value is not an integer number</format-error>
     		<min-error>The length value cannot be less than 20</min-error>
     	</validation>
     </field> 
 
    </fieldset>
      
      

    <fieldset>
        <field type='text' name="email" label='Your email address' >
          <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
          <validation format="EMAIL" />
        </field>
    </fieldset>
      
    </input>
    
    <process>
      <qsub>  
      <tcoffee >
        <args>
          -in=${seqs}
          -mode=expresso
          -blast=LOCAL
          -pdb_db=${settings.PDB_DB}
          -method=${method1} ${method2} ${method3}
          -pdb=${pdb1}
          -pdb=${pdb2}
          -pdb=${pdb3}
          -evaluate_mode=t_coffee_slow
          -template_file=${templateFile} ${templateCheck} 
          -output=${output} 
          -maxnseq=150 
          -maxlen=2500 
          -case=${letter} 
          -seqnos=${seqnos} 
          -outorder=${outorder} 
          -run_name=result
          -multi_core=${settings.multicore}
        </args> 
      </tcoffee>
      </qsub>
    </process>
  </service>

  <!-- ========================================================================
      PSI-COFFEE
      ======================================================================== -->
  <service name="psicoffee" >
    <title>PSI-Coffee</title>
    <group>Alignment</group>      
    <description>Aligns distantly related proteins using homology extension (slow and accurate)</description>
    <cite>http://www.ncbi.nlm.nih.gov/pubmed/21558174%2C19648142</cite>
    
    <input>
      <fieldset >
        <title>Sequences input</title>
    <description>Paste or upload your set of sequences in FASTA format</description>
      
        <field type='memo' name='seqs' label='Sequences to align' >
          <hint>Enter the sequences to align</hint>
          <validation format='FASTA' type="amino-acid" required='true' minnum='2' maxnum='150' maxlen='2500' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
          </validation>
          
          <sample>public/sample.fasta.txt</sample>
        </field>

      </fieldset>
      
      <fieldset hideable="true" >
        <title>Methods</title>
        <description>T-Coffee produces an alignment by combining the output of several alignment methods. Use this section to select the individual methods.</description>
        
        <field type="checkbox" name="method1" label="Pairwise Structual Methods">
          <choices>sap_pair, TMalign_pair, mustang_pair </choices>
        </field>
        
        <field type="checkbox" name="method2" label="Multiple Methods">
          <choices>pcma_msa, mafft_msa, clustalw_msa, dialigntx_msa, poa_msa, muscle_msa, probcons_msa, t_coffee_msa, amap_msa, kalign_msa, fsa_msa, probconsRNA_msa, mus4_msa</choices>
        </field>

        <field type="checkbox" name="method3" label="Pairwise Methods">
          <choices>best_pair4prot, fast_pair, clustalw_pair, lalign_id_pair, slow_pair, proba_pair </choices>
        </field>
      </fieldset>
      
      
    <fieldset hideable="true">
     <title>Output options</title>
     <description>Use this section to control the output format.</description>
      
     <field type="checkbox" name='output' label='Alignment format' >
       <value>score_html fasta_aln clustalw_aln phylip score_ascii</value>
       <choices>score_html, clustalw_aln, pir_aln, pir_seq, gcg, fasta_aln, score_ascii, msf_aln, phylip, score_pdf</choices>
       <readonly>score_html score_ascii</readonly>
     </field>

     <field type='dropdown' name='letter' label='Case' >
       <hint>Output case selection</hint>
       <choices>upper, lower, keep</choices>
     </field>      

     <field type='dropdown' name='seqnos' label='Residue number' >
      <hint>Print the residue number</hint>
      <choices>on, off</choices>
      <value>off</value>  
     </field>
      
     <field type='dropdown' name='outorder' >
       <choices>input, aligned</choices>
     </field>
     
      <field type="text" name="msa_max_len" label="Alignment length" >
     	<hint>The maximum length of the result alignment, after that the sequence is splitted on another row</hint>
     	<value>80</value>
     	<validation format="integer" min="20">
     		<format-error>The entered value is not an integer number</format-error>
     		<min-error>The length value cannot be less than 20</min-error>
     	</validation>
     </field> 
     
     
    </fieldset>
      

    <fieldset>
        <field type='text' name="email" label='Your email address' >
          <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
          <validation format="EMAIL" />
        </field>
    </fieldset>
    </input>
    
    <process>
      <qsub>  
      <tcoffee >
        <args>
          -in=${seqs} 
          -mode=psicoffee
          -blast=LOCAL
          -protein_db=${settings.PROTEIN_DB}
          -method=${method1} ${method2} ${method3} 
          -output=${output} 
          -maxnseq=150 
          -maxlen=2500 
          -case=${letter} 
          -seqnos=${seqnos} 
          -outorder=${outorder} 
          -run_name=result
          -multi_core=${settings.multicore}
        </args>
      </tcoffee>
      </qsub>  
    </process>
    
  </service>  
  
  <!-- ========================================================================
      TM-COFFEE
      ======================================================================== -->
  <service name="tmcoffee" >
    <title>PSI/TM-Coffee</title>
    <group>Alignment</group>      
    <description>Align Proteins using Homology Extension against Reduced Databases</description>
    <cite><![CDATA[http://www.ncbi.nlm.nih.gov/pubmed/22536955]]></cite>
    
    <input>
      <fieldset >
        <title>Sequences input</title>
    	<description>Paste or upload your set of sequences in FASTA format</description>
      
        <field type='memo' name='seqs' label='Sequences to align' >
          <hint>Enter the sequences to align</hint>
          <validation format='FASTA' type="amino-acid" required='true' minnum='2' maxnum='1000' maxlen='5000' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 1000 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 5000 char length</maxlen-error>
          </validation>
          
          <sample>public/sample-tm.fasta.txt</sample>
        </field>

      </fieldset>
      
    <fieldset >
     <title>Homology search options</title>

     <field type='checkbox' name='type' label='Sequence type' >
        <choices>transmembrane</choices>
     </field>  

     <field type='dropdown' name='db' label='Homology Extension' >
       <choices>UniRef50 -- Very Fast/Rough,UniRef90 -- Fast/Approximate,UniRef100 -- Slow/Accurate</choices>
     </field>

    </fieldset>  
      
    <fieldset hideable="true">
     <title>Output options</title>
     <description>Use this section to control the output format.</description>
      
     <field type="checkbox" name='output' label='Alignment format' >
       <value>fasta_aln clustalw_aln phylip score_ascii</value>
       <choices>clustalw_aln, pir_aln, pir_seq, gcg, fasta_aln, score_ascii, msf_aln, phylip</choices>
       <readonly>fasta_aln score_ascii</readonly>
     </field>
  
     <field type="checkbox" name='output2' label='Graphic formats' >
       <value>score_html</value>
       <choices>score_html, score_pdf</choices>
     </field>

     <field type='dropdown' name='letter' label='Case' >
       <hint>Output case selection</hint>
       <choices>upper, lower, keep</choices>
     </field>      

     <field type='dropdown' name='seqnos' label='Residue number' >
      <hint>Print the residue number</hint>
      <choices>on, off</choices>
      <value>off</value>  
     </field>
      
     <field type='dropdown' name='outorder' >
       <choices>input, aligned</choices>
     </field>
     
      <field type="text" name="msa_max_len" label="Alignment length" >
     	<hint>The maximum length of the result alignment, after that the sequence is splitted on another row</hint>
     	<value>80</value>
     	<validation format="integer" min="20">
     		<format-error>The entered value is not an integer number</format-error>
     		<min-error>The length value cannot be less than 20</min-error>
     	</validation>
     </field> 
    </fieldset>

    <fieldset>
        <field type='text' name="email" label='Your email address' >
          <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
          <validation format="EMAIL" />
        </field>
    </fieldset>
    </input>
    
    <process>
      <qsub>  
      <tcoffee program='tmcoffee.sh' >
      	<env BLASTDB="${settings.UNIREFTM_DB}"  /> 
        <args>
          -in ${seqs} 
          -mode psicoffee
          -blast_server LOCAL
          --search-db '${db}'
          --search-type '${type}'  
	  -prot_min_sim 50 
          -prot_max_sim 90 
	  -prot_min_cov 70
          --search-out '${output} ${output2}'
          -maxnseq 1000 
          -maxlen 5000 
          -case ${letter} 
          -seqnos ${seqnos} 
          -outorder ${outorder} 
          -run_name result
          -multi_core ${settings.multicore}
        </args>
      </tcoffee>
      </qsub>  
    </process>
  </service>    
    
  <!-- ========================================================================
      Pro-Coffee    
      ======================================================================== -->
  <service name="procoffee" >
    <title>Pro-Coffee</title>
   <group>Alignment</group>      
    <description>Aligns homologous promoter regions (new)</description>
    <cite><![CDATA[http://www.ncbi.nlm.nih.gov/pubmed/22230796]]></cite>
    
    <input>
      <fieldset >
        <title>Sequences input</title>
    	<description>Paste or upload your set of sequences in FASTA format</description>
      
        <field type='memo' name='seqs' label='Sequences to align' >
          <hint>Enter the sequences to align</hint>
          <validation format="FASTA" type="nucleic-acid" required="true" minnum="2" maxnum="150" maxlen='10000' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 10.000 bp</maxlen-error>
          </validation>
          
          <sample>public/sample-pro.fasta.txt</sample>
        </field>

      </fieldset>
      
      <fieldset hideable="true" >
        <title>Methods</title>
        <description>T-Coffee produces an alignment by combining the output of several alignment methods. Use this section to select the individual methods.</description>
        
        <field type="checkbox" name="method1" label="Pairwise Structual Methods">
          <choices>sap_pair, TMalign_pair, mustang_pair </choices>
        </field>
        
        <field type="checkbox" name="method2" label="Multiple Methods">
          <choices>pcma_msa, mafft_msa, clustalw_msa, dialigntx_msa, poa_msa, muscle_msa, probcons_msa, t_coffee_msa, amap_msa, kalign_msa, fsa_msa, probconsRNA_msa, mus4_msa</choices>
        </field>

        <field type="checkbox" name="method3" label="Pairwise Methods">
          <choices>best_pair4prot, fast_pair, clustalw_pair, lalign_id_pair, slow_pair, proba_pair </choices>
        </field>
        
      </fieldset>
      
      
    <fieldset hideable="true">
     <title>Output options</title>
     <description>Use this section to control the output format.</description>
      
     <field type="checkbox" name='output' label='Alignment format' >
       <value>score_html fasta_aln clustalw_aln phylip score_ascii</value>
       <choices>score_html, clustalw_aln, pir_aln, pir_seq, gcg, fasta_aln, score_ascii, msf_aln, phylip, score_pdf</choices>
       <readonly>score_html score_ascii</readonly>
     </field>

     <field type='dropdown' name='letter' label='Case' >
       <hint>Output case selection</hint>
       <choices>upper, lower, keep</choices>
     </field>      

     <field type='dropdown' name='seqnos' label='Residue number' >
      <hint>Print the residue number</hint>
      <choices>on, off</choices>
      <value>off</value>  
     </field>
      
     <field type='dropdown' name='outorder' >
       <choices>input, aligned</choices>
     </field>
     
     <field type="text" name="msa_max_len" label="Alignment length" >
     	<hint>The maximum length of the result alignment, after that the sequence is splitted on another row</hint>
     	<value>80</value>
     	<validation format="integer" min="20">
     		<format-error>The entered value is not an integer number</format-error>
     		<min-error>The length value cannot be less than 20</min-error>
     	</validation>
     </field> 
    </fieldset>
      

    <fieldset>
        <field type='text' name="email" label='Your email address' >
          <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
          <validation format="EMAIL" />
        </field>
    </fieldset>
    </input>
    
    <process>
      <qsub>  
      <tcoffee >
        <args>
          -in=${seqs} 
          -mode=procoffee 
          -method=${method1} ${method2} ${method3} 
          -output=${output} 
          -maxnseq=150 
          -maxlen=10000 
          -case=${letter} 
          -seqnos=${seqnos} 
          -outorder=${outorder} 
          -run_name=result
          -multi_core=${settings.multicore}
        </args>
      </tcoffee>
      </qsub>   
    </process>
    
  </service>  
  
  <!-- ========================================================================
      ACCURATE   
      ======================================================================== -->
  <service name="accurate" >
    <title>Accurate</title>
   <group>Alignment</group>      
    <description>Automatically combine the most accurate modes for DNA, RNA and Proteins (experimental!)</description>
    
    <input>
      <fieldset >
        <title>Sequences input</title>
    <description>Paste or upload your set of sequences in FASTA format</description>
      
        <field type='memo' name='seqs' label='Sequences to align' >
          <hint>Enter the sequences to align</hint>
          <validation format='FASTA' type='amino-acid' required='true' minnum='2' maxnum='150' maxlen='2500' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
          </validation>
          
          <sample>public/sample.fasta.txt</sample>
        </field>

      </fieldset>
      
      <fieldset hideable="true" >
        <title>Methods</title>
        <description>T-Coffee produces an alignment by combining the output of several alignment methods. Use this section to select the individual methods.</description>
        
        <field type="checkbox" name="method1" label="Pairwise Structual Methods">
          <choices>sap_pair, TMalign_pair, mustang_pair </choices>
        </field>
        
        <field type="checkbox" name="method2" label="Multiple Methods">
          <choices>pcma_msa, mafft_msa, clustalw_msa, dialigntx_msa, poa_msa, muscle_msa, probcons_msa, t_coffee_msa, amap_msa, kalign_msa, fsa_msa, probconsRNA_msa, mus4_msa</choices>
        </field>

        <field type="checkbox" name="method3" label="Pairwise Methods">
          <choices>best_pair4prot, fast_pair, clustalw_pair, lalign_id_pair, slow_pair, proba_pair </choices>
        </field>
        
      </fieldset>
      
      
    <fieldset hideable="true">
     <title>Output options</title>
     <description>Use this section to control the output format.</description>
      
     <field type="checkbox" name='output' label='Alignment format' >
       <value>score_html fasta_aln clustalw_aln phylip score_ascii</value>
       <choices>score_html, clustalw_aln, pir_aln, pir_seq, gcg, fasta_aln, score_ascii, msf_aln, phylip, score_pdf</choices>
       <readonly>score_html score_ascii</readonly>
     </field>

     <field type='dropdown' name='letter' label='Case' >
       <hint>Output case selection</hint>
       <choices>upper, lower, keep</choices>
     </field>      

     <field type='dropdown' name='seqnos' label='Residue number' >
      <hint>Print the residue number</hint>
      <choices>on, off</choices>
      <value>off</value>  
     </field>
      
     <field type='dropdown' name='outorder' >
       <choices>input, aligned</choices>
     </field>
     
      <field type="text" name="msa_max_len" label="Alignment length" >
     	<hint>The maximum length of the result alignment, after that the sequence is splitted on another row</hint>
     	<value>80</value>
     	<validation format="integer" min="20">
     		<format-error>The entered value is not an integer number</format-error>
     		<min-error>The length value cannot be less than 20</min-error>
     	</validation>
     </field> 
     
    </fieldset>
      

    <fieldset>
        <field type='text' name="email" label='Your email address' >
          <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
          <validation format="EMAIL" />
        </field>
    </fieldset>
    </input>
    
    <process>
      <qsub>  
      <tcoffee >
        <args>
          -in=${seqs} 
          -mode=accurate
          -blast=LOCAL
          -method=${method1} ${method2} ${method3} 
          -output=${output} 
          -maxnseq=150 
          -maxlen=2500 
          -case=${letter} 
          -seqnos=${seqnos} 
          -outorder=${outorder} 
          -run_name=result
          -multi_core=${settings.multicore}
        </args>
      </tcoffee>
      </qsub>   
    </process>
  </service>   


  
  <!-- ========================================================================
      COMBINE
       ======================================================================== -->

  <service name="combine">
  <title>Combine</title>
  <description>Combines two (or more) multiple sequence alignments into a single one</description>
  <group>Alignment</group>
  <cite><![CDATA[http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&db=PubMed&list_uids=21558174,10964570]]></cite>
  
  <input>
    <fieldset >
      <title>Sequences input</title>
      <description>Upload each of the Multiple Sequence alignments you want to combine. The alignments must be in FASTA or ClustaW format. Click on &quot;show more options&quot; to combine more than 2 alignments.</description>
       
      <field type='memo' name="aln1" label='Sequences alignment' >
          <validation format='FASTA | CLUSTAL' type='amino-acid' required='true' minnum='2' maxnum='150' maxlen='2500' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA or CLUSTAL format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
          </validation>
            
            <sample >public/sample-clustalw.txt</sample>
      </field>

      <field type='memo' name="aln2" label='Sequences alignment' >
          <validation format='FASTA | CLUSTAL' type='amino-acid' required='true' minnum='2' maxnum='150' maxlen='2500' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA or CLUSTAL format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
          </validation>

            <sample >public/sample-clustalw.txt</sample>
      </field>

    </fieldset>

	<fieldset hideable="true">
      <title>More sequences input</title>
      <description>You can combine up to 6 alignments. The alignments must be in FASTA or ClustalW format. </description>

      <field type='memo' name="aln3" label='Sequences alignment' >
          <validation format='FASTA | CLUSTAL' type='amino-acid' minnum='2' maxnum='150' maxlen='2500' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA or CLUSTAL format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
          </validation>
      </field>

      <field type='memo' name="aln4" label='Sequences alignment' >
          <validation format='FASTA | CLUSTAL' type='amino-acid' minnum='2' maxnum='150' maxlen='2500' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA or CLUSTAL format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
          </validation>
      </field>

      <field type='memo' name="aln5" label='Sequences alignment' >
          <validation format='FASTA | CLUSTAL' type='amino-acid' minnum='2' maxnum='150' maxlen='2500' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA or CLUSTAL format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
          </validation>
      </field>

      <field type='memo' name="aln6" label='Sequences alignment' >
          <validation format='FASTA | CLUSTAL' type='amino-acid' minnum='2' maxnum='150' maxlen='2500' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA or CLUSTAL format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
          </validation>
      </field>
	</fieldset>

    <fieldset hideable="true">
      <title>Output options</title>
      <description>Use this section to control the output format.</description>
      
      <field type="checkbox" name='output' label='Alignment format' >
        <value>score_html fasta_aln clustalw_aln phylip score_ascii</value>
        <choices>score_html, clustalw_aln, pir_aln, pir_seq, gcg, fasta_aln, score_ascii, msf_aln, phylip, score_pdf</choices>
        <readonly>score_html score_ascii</readonly>
      </field>
      
      <field type='dropdown' name='letter' label='Case' >
        <hint>Output case selection</hint>
        <choices>upper, lower, keep</choices>
      </field>      
      
      <field type='dropdown' name='seqnos' label='Residue number' >
      <hint>Print the residue number</hint>
      <choices>on, off</choices>
      <value>off</value>  
      </field>
      
      <field type='dropdown' name='outorder' >
        <choices>input, aligned</choices>
      </field>
      
      <field type="text" name="msa_max_len" label="Alignment length" >
     	<hint>The maximum length of the result alignment, after that the sequence is splitted on another row</hint>
     	<value>80</value>
     	<validation format="integer" min="20">
     		<format-error>The entered value is not an integer number</format-error>
     		<min-error>The length value cannot be less than 20</min-error>
     	</validation>
     </field> 
      
    </fieldset>  
  
    <fieldset>
      <field type='text' name="email" label='Your email address' >
        <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
        <validation format="EMAIL" />
      </field>
    </fieldset>
        
  </input>
  
  <process>
      <qsub>
      <tcoffee>
        <args >
        -in=${aln1} 
        -in=${aln2}  
        -in=${aln3}  
        -in=${aln4}  
        -in=${aln5}  
        -in=${aln6}  
        -output=${output} 
        -evaluate_mode=t_coffee_slow 
        -maxnseq=80 
        -maxlen=2500  
        -run_name=result
        -multi_core=${settings.multicore}
        </args>
      </tcoffee>
      </qsub>
  </process>
  </service>  
      
  <!-- 
    CORE mode 
    -->
  <service name="core">
    <title>TCS</title>
    <description>Evaluates your Alignment and outputs a Colored version indicating the local reliability.</description>
    <group>Evaluation</group>
    <cite><![CDATA[http://www.ncbi.nlm.nih.gov/pubmed/25855806,24694831,21558174,10964570]]></cite>
    
    <input>
    <fieldset >
      <title>Alignment input</title>
      <description>Paste or upload your Multiple Sequence Alignment in CLUSTAL, FASTA, MSF, NEXUS or PHYLIP format.</description>
      
      <field type='memo' name="alignment" label="MSA to evalute" >
          <hint>Do not enter more than 1'000 sequences and length larger than 5'000.</hint>

          <validation format='TEXT' required='true' >
            <required-error>You have to enter the sequences to evaluate</required-error>
          </validation>

          <sample >public/sample-clustalw.txt</sample>
      </field>
      </fieldset>

	<fieldset hideable='true' >
            <title>Filter options</title>
            <description>Use these options to control the filtering intensity of your output alignment and whether you want the filtering to remove columns (recommended) or residues</description>

            <field type='radio' name='filter_type' label='Filter' >
                <value>column</value>
                <choices>column,residue</choices>
            </field>

            <field type='range' name='filter_min' label='Min' min="0" max="9" >
                <value>4</value>
            </field>

            <field type='range' name='filter_max' label='Max' min='0' max='9' >
                <value>9</value>
            </field>


            <field type="checkbox" name='filter_gap' label='Remove empty columns' >
                <value>yes</value>
                <choices>yes</choices>
            </field>

        </fieldset>


        <fieldset>
            <title>Output options</title>
            <description>Use these options to control the output formats of your output alignment</description>

            <field type="checkbox" name='out1' label='Filtered' >
                 <value>clustalw_aln,fasta_aln,phylip</value>
                 <choices>clustalw_aln,fasta_aln,phylip </choices>
            </field>

            <field type="checkbox" name='out2' label='Weighted' >
                <value>score_ascii,tcs_weighted,tcs_replicate</value>
                <choices>score_ascii,tcs_weighted,tcs_replicate</choices>
                <readonly>score_ascii</readonly>
                <hint>
                    tcs_weighted: MSA with columns duplicated according to their TCS score. Suitable for phylogenetic reconstruction.
                    tcs_replicate100: 100 replicates drawn from the original MSA columns weighted according to their TCS score. SUitable for phylogenetic bootstraping.
                </hint>
            </field>

            <field type="checkbox" name='out3' label='Graphic' >
                <choices>score_html,score_pdf</choices>
                <value>score_html</value>
                <readonly>score_html</readonly>
            </field>

            <custom>
                <![CDATA[
                <script>
                    $('#filter_min').change(function(){
                    var min=$('#filter_min').val()
                    var max=$('#filter_max').val()
                    if( min>max ) { $('#filter_max').val(min); $('#filter_max_lbl').text(min); }
                    $('#filter_min_lbl').text(min)
                    })
                    $('#filter_max').change(function(){
                    var min=$('#filter_min').val()
                    var max=$('#filter_max').val()
                    if( min>max ) { $('#filter_min').val(max);  $('#filter_min_lbl').text(max) }
                    $('#filter_max_lbl').text(max)
                    })

                    $(document).ready(function(){
                       $('#alignment_wrap ~ span').after('<div style="width: 54em"><br>Note: TCS requires a multiple sequence alignment. If your sequences are *not* aligned, click the the following link to align them with <a href="/apps/tcoffee/do:regular">T-Coffee</a>. In the result page click the "Core/TCS" button to return to this page.</div>')           
                    })
                </script>
                ]]>
            </custom>
        </fieldset>
  
    <fieldset hideable="true" >
          <title>Library Computation</title>
          <description>Your alignment is evaluated by comparison against a collection of alignments. This collection is named a Library. This section lets you control the computation of the library. Different libraries give different score results</description>

          <field type="checkbox" name="method" label="Pairwise Methods" >
          <value>Mproba_pair</value>
            <choices>Mproba_pair, Mkalign_msa, Mmafft_msa, Mmuscle_msa, Mlalign_id_pair, Mclustalw_pair, Mfast_pair, Mslow_pair</choices>
          </field>
    </fieldset>

    <fieldset>
      <field type='text' name="email" label='Your email (optional)' >
        <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
        <validation format="EMAIL" />
      </field>
    </fieldset>
    </input>
    
    <process>
        <qsub opts='-l virtual_free=8G'>
        <tcoffee program='tcs.sh' >
          <args>
          -infile ${alignment}  
          -in ${method}  
          -score 1 
          -output ${out1} ${out2} ${out3}
          -maxnseq 1000 
          -maxlen 5000 
          -seqnos off
          -run_name result
          -multi_core ${settings.multicore}
          --filter-type ${filter_type}
          --filter-min ${filter_min}
          --filter-max ${filter_max}
          --filter-gap ${filter_gap}
          </args> 
        </tcoffee>
        </qsub>
    </process>    
  </service>
  
  <!-- 
    iRMSD-APDB mode 
    -->  
  <service name="irmsd">
    <title>iRMSD-APDB</title>
    <description>Evaluates Multiple Sequence Alignment using structural information with APDB and iRMSD.</description>
    <group>Evaluation</group>
    <cite><![CDATA[http://www.ncbi.nlm.nih.gov/entrez/query.fcgi?cmd=Retrieve&db=PubMed&list_uids=21558174,16873492,17032685,12855461]]></cite>
    
    <input>
    <fieldset >
      <title>Alignment input</title>
      <description>Paste or upload your Multiple Sequence Alignment in CLUSTAL format.</description>
      
      <field type='memo' name="alignment" label='Alignment' >
          <hint>Enter your alignment</hint>

          <validation format='CLUSTAL' type='amino-acid' required='true' minnum='2' maxnum='150' maxlen='2500' >
            <required-error>You have to enter the sequences to evaluate</required-error>
            <format-error>Sequences have to be in CLUSTAL format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
          </validation>

          <sample >public/sample-clustalw.txt</sample>
      </field>
      </fieldset>

    <fieldset hideable="true">
      <title>Srad - the Sphere Radius</title>
      <description>APDB is a local method and the structural neighbourhood of each residue is used to estimate its alignment accuracy. This Neighbourhood is a sphere of radius Srad (in ngstrm). A sphere with a 10 ngstrm Radius contains between 20-40 amino acids.</description>
      
      <field type="dropdown" name="srad" label="Srad" >
          <value>10</value> 
        <choices>1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 1000</choices>
        <hint>Set Srad, the Sphere radius (ngstrm). High Srad &lt;=&gt; More stringent measure</hint>
      </field>
    </fieldset>
    
    <fieldset hideable="true">
      <title>T1 - the Distance Threshold</title>
      <description>Within a sphere, each pair of aligned residues either agrees or disagrees with the central residues alignment. Pairs of aligned residues whose difference of distance (Delta) is lower than T1 are considered to be supportive, pairs of residues above T1 are considered unsupportive.</description>
      
      <field type="dropdown" name="t1" label="T1" >
          <value>2.0</value> 
        <choices>0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2.0, 2.1, 2.2, 2.5</choices>
        <hint>T1 (ngstrm) the Delta Threshold. Low T1 &lt;=&gt; More stringent measure.</hint>
      </field>
    </fieldset>

    <fieldset hideable="true">
      <title>T2 - the Neighbourhood Support</title>
      <description>The final APDB score indicates the proportion of aligned residues correctly aligned from an APDB point of view. APDB considers that a pair of residues is correctly aligned if T2 percent of its neighbourhood is supportive (as defined above in the T1 section).</description>
      
      <field type="dropdown" name="t2" label="T2">
          <value>70</value> 
        <choices>20, 30, 40, 50, 60, 70, 80, 90, 100</choices>
        <hint>T2 (%) The Neighbourhood Support Limit. Hight T2 &lt;=&gt; More stringent Measure.</hint>
      </field>
    </fieldset>

    <fieldset>
      <field type='text' name="email" label='Your email address' >
        <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
        <validation format="EMAIL" />
      </field>
    </fieldset>
    </input>
    
    <process>
      <qsub>
      <tcoffee>
        <args>
          -other_pg apdb 
          -aln ${alignment}  
          -apdb_outfile default 
          -outfile default 
          -io_format hsg3 
          -output score_html 
          -maximum_distance ${srad} 
          -md_threshold ${t1}
          -similarity_threshold ${t2}  
          -template_file EXPRESSO
          -run_name result 
          -quiet stdout
        </args> 
      </tcoffee>
      </qsub>
    </process>
  </service>
  
  <!-- 
 	T-RMSD 
   -->

  <service name="trmsd">
   <title >T-RMSD</title>
   <description>Allows fine-grained structural clustering of a given group of related protein domains (new)</description>
   <group>Evaluation</group>
     <cite><![CDATA[http://www.ncbi.nlm.nih.gov/pubmed/20471393]]></cite>
  
     <input>
      <fieldset >
        <title>Sequences input</title>
		<description>Paste or upload your set of sequences in FASTA format</description>
      
        <field type='memo' name="seqs" label='Sequences to align' >
          <hint>Enter the sequences to align</hint>
          <validation format="FASTA" type="amino-acid" required="true" minnum="2" maxnum="150" maxlen="2500">
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
          </validation>
          
          <sample>public/sample-trmsd.fasta.txt</sample>
        </field>

      </fieldset>
      
      <fieldset hideable="true">
        <title>Structure(s) input</title>
        <description>Upload your PDB structure if needed (Do NOT upload Confidential Data!)</description>

        <field type="file" name="pdb1" label="PDB file" >
        </field>
  
        <field type="file" name="pdb2" label="PDB file" >
        </field>
  
        <field type="file" name="pdb3" label="PDB file" >
        </field>

      </fieldset>
      
      <fieldset hideable="true" >
        <title>Library Computation</title>
        <description>Select the methods you want to use to compute the library. T-Coffee uses various sequence and structure alignment methods to compile a collection of alignments known as a Library. Use this section to select the methods.</description>
        
        <field type="checkbox" name="method1" label="Pairwise Structual Methods">
          <choices>sap_pair, TMalign_pair, mustang_pair </choices>
        </field>
        
        <field type="checkbox" name="method2" label="Multiple Methods">
          <choices>pcma_msa, mafft_msa, clustalw_msa, dialigntx_msa, poa_msa, muscle_msa, probcons_msa, t_coffee_msa, amap_msa, kalign_msa, fsa_msa, probconsRNA_msa, mus4_msa</choices>
        </field>

        <field type="checkbox" name="method3" label="Pairwise Methods">
          <choices>best_pair4prot, fast_pair, clustalw_pair, lalign_id_pair, slow_pair, proba_pair </choices>
        </field>

      </fieldset>
      
      <fieldset hideable="true">
        <title>PDB structure selection</title>
        <description>Specify which PDB structure (template) should be associated with which each sequence. The uploaded PDBs are automatically associated with their own sequence. Check the box to automatically fetch the templates, or fill the box and specify the sequence/template association</description>
        <field type='memo' name='templateFile' label='Enter your template' >
        <hint>
        <![CDATA[
    Check the box below to automatically fetch the templates, or fill this box and specify the sequence/template association using the following format (specified template superseed the others):
<pre>
>sequence_name1 _P_ PDBID
>sequence_name2 _P_ PDBID
...       
</pre>  
        ]]>
        </hint>
        
        </field>
        
        <field type='checkbox' name='templateCheck' label='Automatically fetch pdb templates' >
          <hint>Check This Box To automatically Fetch Homologous Structures with BLAST</hint>
          <choices>MODE_PDB</choices>    
        </field>
        
      </fieldset>

    <fieldset hideable="true">
     <title>Output options</title>
     <description>Use this section to control the output format.</description>
      
     <field type='dropdown' name='letter' label='Case' >
       <hint>Output case selection</hint>
       <choices>upper, lower, keep</choices>
     </field>      

     <field type='dropdown' name='outorder' >
       <choices>input, aligned</choices>
     </field>
 
      <field type="text" name="msa_max_len" label="Alignment length" >
     	<hint>The maximum length of the result alignment, after that the sequence is splitted on another row</hint>
     	<value>80</value>
     	<validation format="integer" min="20">
     		<format-error>The entered value is not an integer number</format-error>
     		<min-error>The length value cannot be less than 20</min-error>
     	</validation>
     </field> 
 
    </fieldset>
      
      

    <fieldset>
        <field type='text' name="email" label='Your email address' >
          <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
          <validation format="EMAIL" />
        </field>
    </fieldset>
      
    </input>
    
    <process>
      <qsub>  
      <tcoffee >
        <args>
        <![CDATA[
          -in=${seqs}
          -mode=expresso
          -cache=$PWD
          -blast=LOCAL
          -pdb_db=${settings.PDB_DB}
          -method=${method1} ${method2} ${method3}
          -pdb=${pdb1}
          -pdb=${pdb2}
          -pdb=${pdb3}
          -evaluate_mode=t_coffee_slow
          -template_file=${templateFile} ${templateCheck} 
          -output=aln score_html 
          -maxnseq=150 
          -maxlen=2500 
          -case=${letter} 
          -seqnos=${seqnos} 
          -outorder=${outorder} 
          -run_name=result
          -multi_core=${settings.multicore}
          -quiet=stdout; t_coffee -other_pg trmsd result.aln -template_file result_pdb1.template_list -output color_html 2>&1; [ -e result.struc_tree.consensus ]  
         ]]>
        </args> 
      </tcoffee>
      </qsub>
      
    </process>
  </service>


  <!--  
  	STRIKE mode
   -->
   
 <service name="strike">
   <title >Strike</title>
   <description>Evaluation of protein MSAs using a single 3D structure</description>
   <group>Evaluation</group>
     <cite><![CDATA[http://www.ncbi.nlm.nih.gov/pubmed/22039207]]></cite>
  
     <input>
      <fieldset >
        <title>Sequences input</title>
    	<description>Paste or upload your set of sequences in FASTA format</description>
      
        <field type='memo' name="seqs" label='Evaluation' >
          <hint>Enter the sequences to align</hint>
          <validation format="FASTA" type="amino-acid" required="true" minnum="2" maxnum="150" maxlen="2500" samelen='true' >
            <required-error>You have to enter the sequences to align</required-error>
            <format-error>Sequences have to be in FASTA format</format-error>
            <minnum-error>You must enter at least 2 sequences</minnum-error>
            <maxnum-error>You can enter at most 150 sequences</maxnum-error>
            <maxlen-error>Sequences cannot exceed 2500 char length</maxlen-error>
            <samelen-error>All the sequences entered must have that same length</samelen-error>
          </validation>
          
          <sample>public/sample-strike.fa</sample>
        </field>

      </fieldset>
      

      <fieldset hideable="true">
        <title>PDB structure selection</title>
        <description>Specify which PDB structure (template) should be associated with which each sequence. The uploaded PDBs are automatically associated with their own sequence. Check the box to automatically fetch the templates, or fill the box and specify the sequence/template association</description>
        <field type='memo' name='templateFile' label='Enter your template' >
        <hint>
        <![CDATA[
    Check the box below to automatically fetch the templates, or fill this box and specify the sequence/template association using the following format (specified template superseed the others):
<pre>
>sequence_name1 _P_ PDBID
>sequence_name2 _P_ PDBID
...       
</pre>  
        ]]>
        </hint>
        
        </field>
        
        <field type='checkbox' name='templatePDB' label='Automatically fetch pdb templates' >
          <hint>Check This Box To automatically Fetch Homologous Structures with BLAST</hint>
          <value>PDB</value>
          <choices>PDB</choices>    
        </field>
        
      </fieldset>


      <fieldset hideable="true">
        <title>Structure(s) input</title>
        <description>Upload your PDB structure if needed (Do NOT upload Confidential Data!)</description>

        <field type="file" name="pdb1" label="PDB file" >
        </field>
  
        <field type="file" name="pdb2" label="PDB file" >
        </field>
  
        <field type="file" name="pdb3" label="PDB file" >
        </field>

      </fieldset>
            

    <fieldset>
        <field type='text' name="email" label='Your email address' >
          <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
          <validation format="EMAIL" />
        </field>
    </fieldset>
      
    </input>
    
    <process>
      <qsub>  
      <tcoffee >
      	<logfile>strike.out</logfile>
      	<errfile>tcoffee.log</errfile>
        <args>
          -other_pg strike ${seqs} 
          -template_file ${templatePDB} ${templateFile}
        </args> 
      </tcoffee>
      </qsub>
    </process>
  </service>
   
   
  
  <!-- Special mode to run full t-coffee command lines  -->
  <service name="adv-cmdline">
  	<title>Advanced</title>
  	<description>Run your alignment using full featured T-Coffee options.</description>
  	<action>Application.advanced</action>
  	<cite><![CDATA[http://www.ncbi.nlm.nih.gov/pubmed/21558174%2C10964570]]></cite>
  	
  
  	<input>
	  	<fieldset>
	  	<field type="textarea" name="cmdline" label="Program options">
	        <validation required="true" >
	        <required-error>The options field cannot be empty. You have to enter at least one input file name.</required-error>
	        </validation>
	  	</field>
	  	
	  	
	    <field type='text' name="email" label='Your email address' >
	        <hint>It will be used to notify you on alignment completion. Multiple email addresses can be entered by separating them with commas.</hint>
	        <validation format="EMAIL" />
	    </field>
	    
	    <!-- this field is used to store the list of uplaoded files  -->
	    <field type="hidden" name="uploadedFiles" />
	    
	  	</fieldset>
  	</input>
  
    <process>
      <qsub>
      <tcoffee>
        <args>${cmdline}</args> 
      </tcoffee>
      </qsub>
    </process>
  </service>
  
</bundle>

